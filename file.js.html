<!DOCTYPE html>

<html>
<head>
  <title>file.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="http://chrisdickinson.github.com/narrative/base.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <div id="jump_to">
        Jump To &hellip;
        <div id="jump_wrapper">
          <div id="jump_page">
            
              <a href="http://chrisdickinson.github.com/narrative//destination.js.html" class="source">destination.js</a>
            
              <a href="http://chrisdickinson.github.com/narrative//directory.js.html" class="source">directory.js</a>
            
              <a href="http://chrisdickinson.github.com/narrative//file.js.html" class="source">file.js</a>
            
              <a href="http://chrisdickinson.github.com/narrative//index.js.html" class="source">index.js</a>
            
              <a href="http://chrisdickinson.github.com/narrative//options.js.html" class="source">options.js</a>
            
              <a href="http://chrisdickinson.github.com/narrative//parser.js.html" class="source">parser.js</a>
            
              <a href="http://chrisdickinson.github.com/narrative//utils.js.html" class="source">utils.js</a>
            
          </div>
        </div>
      </div>
    
    <table cellpadding="0" cellspacing="0">
      <thead>
        <tr>
          <th class="docs">
            <h1>
              file.js
            </h1>
          </th>
          <th class="code">
          </th>
        </tr>
      </thead>
      <tbody>
          
          <tr id="section-1">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1>File API</h1>

<p>Provides access to targeted source files.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre><span class="kd">var</span> <span class="nx">method</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./utils&#39;</span><span class="p">).</span><span class="nx">method</span><span class="p">,</span>
    <span class="nx">EE</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;events&#39;</span><span class="p">).</span><span class="nx">EventEmitter</span><span class="p">,</span>
    <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">File</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">parser</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">path</span> <span class="o">=</span> <span class="nx">path</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">parser</span> <span class="o">=</span> <span class="nx">parser</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">filename</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">).</span><span class="nx">basename</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">path</span><span class="p">);</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">register</span><span class="p">();</span>
<span class="p">};</span>

<span class="nx">File</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">register</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-2">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>This will get overridden by the <a href="options.js.html">Options object</a>
when it's being used.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre><span class="p">};</span>

<span class="nx">File</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">method</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">self</span><span class="p">)</span> <span class="p">{</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-3">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Returns an <code>EventEmitter</code> that emits <code>error</code> if <code>self.path</code> does not exist,
or <code>data</code> with the string contents of the file if the file was found.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">ee</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EE</span><span class="p">();</span>
  <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">path</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">err</span> <span class="o">?</span> 
      <span class="nx">ee</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span> <span class="o">:</span>
      <span class="nx">ee</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
  <span class="p">});</span>
  <span class="k">return</span> <span class="nx">ee</span><span class="p">;</span> 
<span class="p">});</span>

<span class="nx">File</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">compile</span> <span class="o">=</span> <span class="nx">method</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">destination</span><span class="p">)</span> <span class="p">{</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-4">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Grab our data...</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>  <span class="nx">self</span><span class="p">.</span><span class="nx">data</span><span class="p">().</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-5">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>if we fail, let <a href="options.js.html">options</a> know.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>    <span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">options</span><span class="p">)).</span>
    <span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-6">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Cool, we've got data, let's compile it.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>      <span class="nx">self</span><span class="p">.</span><span class="nx">parser</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">tuple_list</span><span class="p">)</span> <span class="p">{</span></pre></div>
            </td>
          </tr>
          
          <tr id="section-7">
            <td class="docs">
              <div class="pilwrap">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>If it worked, notify options using <code>visit</code> and <a href="destination.js.html">render the parsed file</a>.</p>
            </td>
            <td class="code">
              <div class="highlight"><pre>        <span class="nx">err</span> <span class="o">?</span> <span class="nx">options</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">:</span> 
          <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">visit</span><span class="p">(</span><span class="nx">self</span><span class="p">),</span> <span class="nx">destination</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">self</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">tuple_list</span><span class="p">));</span>
      <span class="p">});</span>
    <span class="p">});</span>
<span class="p">});</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">File</span> <span class="o">=</span> <span class="nx">File</span><span class="p">;</span>

</pre></div>
            </td>
          </tr>
          
      </tbody>
    </table>
  </div>
</body>
</html>
